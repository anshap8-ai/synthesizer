 ## Children's piano-synthesizer

### Purpose
If your childhood synthesizer has broken down, don't rush to throw it away. Perhaps this project to restore a Chinese-made SD5490-A children's piano-synthesizer will help bring it back to life. My grandson brought me this 54-key musical toy and said, "What can we do with this?" An inspection revealed that the built-in specialized controller (black tablet) had given up the ghost.
![photo1](img/SD5490-A_1.jpg) \
Of course, restoring the device's previous functionality is out of the question. But it was worth trying to revive the tool.

### New scheme
After removing the faulty chip and replacing it with an Atmel AT89C51 microcontroller, the circuit looked like this: ![fig1](img/piano.jpg)  
From the previous composition of elements, it contains: a 7-segment display HL1, a two-channel power amplifier DD3 with speakers and a keyboard matrix. Diodes D1-D8 have been added to the matrix columns. Microcontroller DD1 has a standard circuit with a 12 MHz quartz crystal resonator. Potentiometer R15, together with microcircuit DD2, provides volume control.
![photo3](img/inside_after_repair.jpg)

### Program
The program scans the keyboard matrix and plays the corresponding note in the range from the major octave to the third octave inclusive (all 54 main keys). \
The 7-segment display shows the code of the pressed key. Dynamic indication is used via interrupt *int1*. \
Rectangular pulses of this audio frequency are generated by interrupt *int 3*. \
The function keys are scanned, but are only used to play two built-in musical fragments (see program text) by pressing the *"LISTEN TO RECORDING"* and *"DEMO"* keys, respectively. \
![photo4](img/piano_fkey.jpg) \
The *"TEMP+"* and *"TEMP-"* keys allow you to change the playback tempo of a section. \
The control program was written using the C programming language and the SDCC v.4.1.0 compiler. The program source code *src/midi.c* and the firmware file *src/midi.bin* are included. \
To load a binary file into the flash memory of the microcontroller, the programmer from my *Load_x51* project was used.







